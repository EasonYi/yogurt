<!-- Basic Setup Start-->
<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">登录用户统计</h3>
        <div class="panel-options">
            <a href="#" data-toggle="panel">
                <span class="collapse-icon">&ndash;</span>
                <span class="expand-icon">+</span>
            </a>
            <!-- 关闭
                <a href="#" data-toggle="remove">
                &times;
            </a>
            -->
        </div>
    </div>
    <div class="panel-body">
        <table id="table" class="table  table-bordered table-hover" cellspacing="0" width="100%">
            <thead>
            <tr>
                <th>id</th>
                <th>登录用户</th>
                <th>uri</th>
                <th>会话标识</th>
                <th>本地地址</th>
                <th>远端地址</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
        <script type="text/javascript">
            (function($){
                /**
                 *编辑或者新建 逻辑判断 无后台
                 * rowdata 行数据
                 */
                function editRow(rowdata){
                    //编辑还是保存
                    var flag = rowdata?true:false;
                    //弹出菜单的业务逻辑方法
                    function saveHandler(modal){
                        saveOrUPdate(modal,flag,function(data,status){
                            DF.toast.success(data.message);
                            DF.hideModal(modal);
                            reloadGrid();
                        });
                    }
                    //modal窗口的配置项目
                    var config = {
                        dom:$('#securityOnlineTForm'),
                        title:flag?'编辑页面':'新建页面',
                        btns:[{text:'保存',
                            icon:'btn-info',
                            fn:saveHandler
                        }]
                    };
                    DF.showModal(config,function(modal){
                        /*回调函数中的参数
                         * modal为当前的模块窗口 其中提供 getForm()方法 返回 业务的form 此form为 jq对象
                         */
                        flag && loadForm(modal,rowdata);
                    });
                };
                //删除 走后台
                function deleteRow(rowdata){
                    if(confirm('确认删除吗？')){
                        var url = 'securityOnlineT/'+rowdata.uuid;
                        var sfn = function(data,status){
                            reloadGrid();
                            DF.toast.success(data.message);
                        };
                        DF.ajax({
                            type:'delete',
                            url:url,
                            success:sfn
                        });
                    }
                };
                //加载列表  走后台
                function reloadGrid(){
                    grid.ajax.reload();
                };
                //加载表单  如果rowdata 数据满足  可以直接赋值 不用走后台
                function loadForm(modal,rowdata){
                    var form = modal.getForm();
                    if(rowdata){
                        DF.setFormValues(rowdata,form);
                    }
                };
                //保存表单or编辑表单  走后台
                function saveOrUPdate(modal,flag,fn){
                    var form = modal.getForm();
                    var data = form.serializeObject();
                    var sfn = function(data,status){
                        fn && fn(data,status);
                    };
                    DF.ajax({
                        data:JSON.stringify(data),
                        type:flag?'put':'post',
                        url:'securityOnlineT',
                        dataType:'json',
                        success:sfn
                    });
                };
                var grid = DF.dataTable({
                    id:"table",
                    ajax: "securityOnlineT/list",
                    columns: [
                        {"data": "uuid","orderable":false, "visible": false},
                        {"data": "userName","orderable":false},
                        {"data": "uri","orderable":false,"visible": false},
                        {"data": "sessionId","orderable":false},
                        {"data": "localAddress","orderable":false},
                        {"data": "remoteAddress","orderable":false}
                    ],
                    columnDefs:[{
                        render: function(data, type, row) {
                            return data;
                        },
                        "targets": 2
                    }],
                    createdRow: function ( row, data, index) {
                        $('td', row).click(function(){
                        })
                    },
                    //新建行函数
                    createItem:editRow,
                    //编辑函数
                    editItem :editRow,
                    //删除函数
                    deleteItem :deleteRow,
                    //重新加载
                    reloadGrid :reloadGrid,
                    //初始化结束后回调
                    initComplete: function () {
                    }
                });

            })(jQuery);
        </script>
    </div>
</div>
<!-- Basic Setup  End-->
<script type="text/template" id="securityOnlineTForm">
    <form class="validate"  >
        <div class="row">
            <div class="col-md-12">
                <div class="form-group hidden">
                    <label class="control-label"></label>
                    <input type="text" name="uuid">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="form-group no-margin">
                    <label for="uri" class="control-label">uri</label>
                    <input type="text" name="uri" class="form-control" id="uri"
                           placeholder=""  maxlength="100">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="form-group no-margin">
                    <label for="sessionId" class="control-label">会话标识</label>
                    <input type="text" name="sessionId" class="form-control" id="sessionId"
                           placeholder=""  maxlength="100">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="form-group no-margin">
                    <label for="localAddress" class="control-label">本地地址</label>
                    <input type="text" name="localAddress" class="form-control" id="localAddress"
                           placeholder=""  maxlength="100">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="form-group no-margin">
                    <label for="remoteAddress" class="control-label">远端地址</label>
                    <input type="text" name="remoteAddress" class="form-control" id="remoteAddress"
                           placeholder=""  maxlength="100">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="form-group no-margin">
                    <label for="founderId" class="control-label">创建人ID</label>
                    <input type="text" name="founderId" class="form-control" id="founderId"
                           placeholder=""  maxlength="36">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="form-group no-margin">
                    <label for="founderName" class="control-label">创建人名称</label>
                    <input type="text" name="founderName" class="form-control" id="founderName"
                           placeholder=""  maxlength="20">
                </div>
            </div>
        </div>
    </form>
</script>

