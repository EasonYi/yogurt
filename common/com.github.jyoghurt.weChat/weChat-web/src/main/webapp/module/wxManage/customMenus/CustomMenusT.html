<!-- Basic Setup Start-->
<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">自定义菜单</h3>

        <div class="panel-options">
        </div>
    </div>
    <div class="panel panel panel-default">
        <div class="panel-body">
            <div class="row">
                <!-- 左边PANEL BEGIN -->
                <div class="col-sm-12 col-md-12" style="text-align: center" id="leftPanel">
                    <div class="lymow left-view">
                        <div id="phone" class="phone"
                             style="margin: 75px 0px 90px 15px; padding: 0px; width: 305px; height: 427px; overflow-y: hidden; overflow-x: hidden;">
                            <!-- 模板加载位置 -->
                            <div style="margin: 0px; padding: 0px; width: 290px; height: 427px; overflow: hidden; position: relative;"
                                 class="mod67">
                                <!--手机显示部分DIV-->
                                <div style="height: 90%;background-color:#e7e7eb;text-align: center">
                                    <i class="fa fa-flyway.wechat"
                                       style="position: relative;transform: translateY(-50%);top: 50%;color: #80b636;font-size: 60px;">
                                    </i>
                                </div>
                                <!---->
                                <div id="baseBottom" style="height: 10%;border:#e7e7eb">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 右边PANEL BEGIN -->
                <!--一级菜单-->
                <div class="col-sm-12 col-md-7 hidden" id="rightPanel">
                    <div class="panel-heading">
                        <div class="panel-options">
                            <button id="saveAndSend" type="button" class="btn btn-success icon-right">保存并发布</button>
                            <button id="save" type="button" class="btn btn-success icon-right">保存 <i
                                    class="fa fa-save"></i>
                                <button id="delete" type="button" class="btn btn btn-danger">删除</button>
                                <button id="return" type="button" class="btn btn btn-primary">返回一级菜单</button>
                        </div>
                    </div>
                    <form id="form" role="form" class="validate">
                        <div class="inner">
                            <div class="panel-heading" style="padding:10px 0;border-bottom: none;">
                                <div>菜单级别</div>
                            </div>
                            <div class="form-group ">
                                <label class="control-label" for="menuLevel">菜单级别</label>
                                <input type="text" class="form-control" id="menuLevel" name="menuLevel" readonly="true">
                            </div>
                            <div class="form-group-separator"></div>
                            <div class="panel-heading" style="padding:10px 0;border-bottom: none;">
                                <div>菜单名称</div>
                            </div>
                            <div class="form-group ">
                                <label class="control-label" for="menuName">菜单名称</label>
                                <input type="text" class="form-control" id="menuName" name="menuName"
                                       maxlength="4" required="true">
                            </div>
                            <div class="form-group-separator"></div>
                            <div class="" id="changForm">
                                <div class="panel-heading" style="padding:5px 0;border-bottom: none;">
                                    <div id="changFormName">菜单类型</div>
                                </div>
                                <p id="radio" style="padding-bottom: 15px;">
                                    <label class="cbr-inline">
                                        <input id="menuRadio" type="radio" name="menuType" class="cbr cbr-secondary">
                                        编辑二级菜单
                                    </label>
                                    <label class="cbr-inline">
                                        <input id="msgRadio" type="radio" name="menuType" class="cbr cbr-secondary">
                                        发送消息
                                    </label>
                                    <label class="cbr-inline">
                                        <input id="urlRadio" type="radio" name="menuType" class="cbr cbr-secondary">
                                        跳转网页
                                    </label>
                                </p>
                            </div>
                            <div class="form-group " id="contentDiv">
                                <label class="control-label" for="content">菜单类型</label>
                                <input type="text" class="form-control" id="content" name="content" url="true"
                                       required="true">

                                <p id="alert" style="padding-top:10px;font-size: 12px"><a
                                        style="color:#979898">&nbsp;温馨提示：例如(http://***.*)</a></p>

                                <div id="material"></div>
                                <button id="editSecond" type="button" class="btn btn-success icon-right">点击编辑二级菜单
                                </button>
                            </div>
                            <div class="form-group ">
                                <input type="hidden" class="form-control" id="clickType" name="clickType">
                                <input type="hidden" class="form-control" id="menuId" name="menuName">
                                <input type="hidden" class="form-control" id="parentId" name="menuName">
                            </div>
                        </div>
                    </form>
                </div>
                <!-- 右边PANEL END -->
                <script>
                    (function () {
                        /*常量集合*/
                        var oldList = this.value;
                        var menuList;
                        var appId = "";
                        var appsecret = "";
                        var parentId = "";
                        var sendType = "saveAndSend";
                        var saveType = "save";
                        var formObj = {};
                        /*素材库对象*/
                        var material;
                        /*菜单反馈类型枚举*/
                        var menuTypeEum = {VIEW: "view", ClICK: "click", MEDIA_ID: "media_id", NONE: "none"}
                        /*菜单类型枚举（一级&二级菜单）*/
                        var menuEum = {
                            Bottom: "bottom", SECOND: "second",
                            BOTTOMANDSECOND: "bottomAndSecond", NONE: "none"
                        }
                        /*clickType 1为URL类型 2为添加二级菜单类型 3为图文消息类型*/
                        //加载menu数据入口函数
                        loadAppDetail();
                        var comId = DF.create('df_component_msg_groupSend', $('#material'));
                        //初始化一级菜单方法
                        function initBottomMenu(menuList, onclick, ifSecond, menuType) {
                            if ($('.ul-bottom-control')) {
                                $('.ul-bottom-control').remove();
                            }
                            $('#baseBottom').append('<ul class="ul-bottom-control"> </ul>');

                            for (var i in menuList) {
                                createBottomMenu(menuList[i], onclick, ifSecond);
                            }
                            //创建空一级菜单的数量
                            var addBottomMenuNum = 3 - menuList.length;
                            if (addBottomMenuNum > 0) {
                                createAddBottomMenu(addBottomMenuNum, onclick, ifSecond);
                            }
                        }

                        //初始化二级菜单方法
                        function initSecondaryMenu(menuList, onclick, ifButtom) {
                            if ($('.div-secondary-menu').length > 0) {
                                for (var i in $('.div-secondary-menu')) {
                                    $('.div-secondary-menu')[i].remove();
                                }
                            }
                            for (var i in menuList) {
                                creatSecondaryMenusByParent(menuList[i], onclick, ifButtom);
                            }
                        }

                        //创建一级菜单
                        function createBottomMenu(menu, onclick, ifSecond, menuType) {
                            //一级菜单上层ul
                            var aClass = ifSecond ? "a-buttom-control li-readonly" : "a-buttom-control";
                            var $ul = $('.ul-bottom-control');
                            $ul.append('<li class="li-buttom-control suspend" dataid="' + menu.id + '"> <a' +
                            ' dataid="' + menu.id + '"class="' + aClass + '">' + menu.menuName + '</a></li>');
                            //添加一级菜单点击事件
                            if (onclick) {
                                bottomClick(menu);
                            }
                        }

                        //创建空一级菜单
                        function createAddBottomMenu(num, onclick, ifSecond) {
                            var liClass = ifSecond ? "li-buttom-control suspend li-readonly" : "li-buttom-control suspend";
                            var $ul = $('.ul-bottom-control');
                            for (var i = 0; i < num; i++) {
                                $ul.append('<li class="' + liClass + '" dataid="none"> <a class="a-buttom-control" dataid="none"><i style="font-size: 12px" class="linecons-attach"></i></a></li>');
                                if (onclick) {
                                    bottomClick();
                                }
                            }
                        }

                        //创建二级空菜单
                        function createAddSecMenu(menu, parentId, onclick, ifButtom) {
                            //二级菜单上层ul
                            var liClass = ifButtom ? "li-secondary-menu li-readonly" : "li-secondary-menu";
                            var $div = $('.div-secondary-menu[dataid="' + parentId + '"]');
                            var $ul = $('.ul-secondary-menu[dataid="' + parentId + '"]');
                            $ul.append('<li  dataid="none" dataparentid="' + parentId + '" class="' + liClass + '"><' +
                            'a dataid="' + menu.id + '"><i style="font-size: 12px" class="linecons-attach"></i></a> </li>');
                            if (onclick) {
                                var menu = {}
                                menu.clickType = menuTypeEum.NONE;
                                secondaryClick(menu, parentId, true);
                            }
                            $div.hide();
                        }

                        //根据一级菜单创建二级菜单
                        function creatSecondaryMenusByParent(menu, onclick, ifButtom) {
                            //一级菜单a标签
                            var $parent = $('.a-buttom-control[dataid="' + menu.id + '"]');
                            var className = ifButtom ? "div-secondary-menu speech-bubble speech-bubble-bottom-readonly" : "div-secondary-menu speech-bubble speech-bubble-bottom";
                            if (menu.customMenusTList.length > 0 || !ifButtom) {
                                $parent.after('<div dataid="' + menu.id + '"class="' + className + '"> <ul dataid="' +
                                menu.id + '"class="ul-secondary-menu">' +
                                ' </ul></div>');
                            }
                            //创建二级空菜单
                            if (!ifButtom) {
                                if (5 - menu.customMenusTList.length > 0) {
                                    createAddSecMenu(menu, menu.id, onclick, ifButtom);
                                }
                            }
                            for (var i in menu.customMenusTList) {
                                creatSecondaryMenusLi(menu.customMenusTList[i], menu.id, onclick, ifButtom);
                            }
                        }

                        //创建二级菜单li
                        function creatSecondaryMenusLi(menu, parentId, onclick, ifButtom) {
                            var liClass = ifButtom ? "li-secondary-menu li-readonly" : "li-secondary-menu";
                            //二级菜单上层ul
                            var $div = $('.div-secondary-menu[dataid="' + parentId + '"]');
                            var $ul = $('.ul-secondary-menu[dataid="' + parentId + '"]');
                            $ul.append('<li  dataid="' + menu.id + '" dataparentid="' + parentId + '" class="' + liClass + '"><a dataid="' + menu.id + '">' + menu.menuName + '</a> </li>');
                            if (onclick) {
                                secondaryClick(menu, parentId, false);
                            }
                            $div.hide();
                        }


                        //根据点击一级菜单 弹出二级菜单并隐藏其它二级菜单
                        function fadeInSecondaryMenusByParentId(parentId) {
                            $('.div-secondary-menu').fadeOut("normal");
                            //二级菜单上层ul
                            var $div = $('.div-secondary-menu[dataid="' + parentId + '"]');
                            $div.fadeIn("normal");
                        }


                        /***************************************注册点击事件****************************************/
                        //一级菜单点击事件
                        function bottomClick(menu) {
                            var object = menu ? '.a-buttom-control[dataid="' + menu.id +
                            '"]' : '.a-buttom-control[dataid="none"]';
                            $(object).on('click', function () {
                                fadeInSecondaryMenusByParentId(menu ? menu.id : "");
                                if ($('#rightPanel').hasClass('hidden')) {
                                    $('#leftPanel').addClass('col-md-5');
                                    $('#rightPanel').removeClass('hidden');
                                }
                                /*添加选中样式取消其他选中样式*/
                                if (!$(this).parent().hasClass('menuActive')) {
                                    $('.ul-bottom-control').find('li.menuActive').removeClass('menuActive');
                                    $(this).parent().toggleClass('menuActive');
                                }
                                //初始化表单
                                initFormValues(menu, "一级菜单");
                                if (menu && menu.customMenusTList.length > 0) {//若有二级菜单不让编辑URL
                                    initFormCss("bottomAndSecond", menu.clickType);
                                } else {
                                    initFormCss("bottom", menu ? menu.clickType : menuTypeEum.NONE);
                                }
                            })
                        }

                        /*二级菜单点击事件*/
                        function secondaryClick(menu, parent, ifAdd) {
                            var obj = ifAdd ? '.li-secondary-menu[dataid="none"]' : '.li-secondary-menu[dataid="' + menu.id
                            + '"]';
                            //隐藏changeForm
                            $(obj).on('click', function () {
                                if ($('#rightPanel').hasClass('hidden')) {
                                    $('#leftPanel').addClass('col-md-5');
                                    $('#rightPanel').removeClass('hidden');
                                }
                                /*添加选中样式取消其他选中样式*/
                                if (!$(this).hasClass('menuActive')) {
                                    $('.ul-bottom-control').find('li.menuActive').removeClass('menuActive');
                                    $(this).toggleClass('menuActive');
                                }
                                if (ifAdd) {
                                    initSecondForm(findMenuById($(this).attr('dataparentid')), "二级菜单", ifAdd);
                                } else {
                                    initSecondForm(findMenuById($(this).attr('dataid')), "二级菜单", ifAdd);
                                }
                                initFormCss("second", menu.clickType);
                            })
                        }

                        //radio点击事件
                        /*编辑二级菜单*/
                        $($('label.cbr-inline')[0]).on('click', function () {
                            ChangeFromByType("second");
                        })
                        /*发送消息*/
                        $($('label.cbr-inline')[1]).on('click', function (){
                            ChangeFromByType("msgRadio");
                        })
                        /*页面跳转*/
                        $($('label.cbr-inline')[2]).on('click', function () {
                            ChangeFromByType("url");
                        })
                        //点击编辑二级菜单按钮事件
                        $('#editSecond').on('click', function () {
                            material = DF.getComponent(comId);
                            /*                            if (!formObj.isChange()) {
                             var menuId = $('#menuId').val();
                             if (menuId && menuId != "") {
                             renderByType(false, menuId);
                             } else {
                             renderByType(false, menuList[menuList.length - 1].menuId);
                             }
                             DF.toast.success("操作成功");
                             return;
                             }*/
                            if (confirm('是否保存一级菜单')) {
                                material = DF.getComponent(comId);
                                //保存一级菜单
                                if (DF.validate($('#rightPanel form'))) {
                                    if (saveBottomMenuForm()) {
                                        subBottAndShowSecond();
                                    }
                                }

                            }
                        })
                        //保存菜单方法
                        $('#save').on('click', function () {
                            material = DF.getComponent(comId);
                            /*                      if (!formObj.isChange()) {
                             return;
                             }*/
                            if (DF.validate($('#rightPanel form'))) {
                                if ($('#menuLevel').val() == "一级菜单") {
                                    if (saveBottomMenuForm()) {
                                        subForm(true);
                                    }
                                } else {
                                    if (saveSecondaryForm()) {
                                        subForm(false);
                                    }
                                }
                            }
                        })
                        //删除方法
                        $('#delete').on('click', function () {
                            material = DF.getComponent(comId);
                            deleteMenu();
                        })
                        //发布方法
                        $('#saveAndSend').on('click', function () {
                            material = DF.getComponent(comId);
                            if (DF.validate($('#rightPanel form'))) {//验证表单
                                if ($('#menuLevel').val() == "一级菜单") {
                                    if (saveBottomMenuForm()) {
                                        subAndSendForm(true);
                                    }
                                } else {
                                    if (saveSecondaryForm()) {
                                        subAndSendForm(false);
                                    }
                                }
                            }
                        })
                        //返回一级菜单方法
                        $('#return').on('click', function () {
                            loadAndInit($('#parentId').val());
                        })
                        //默认点击空菜单||上次操作菜单
                        function clickByType(ifBottom, clickId, parentId) {
                            if (ifBottom) {
                                var click = ""
                                if (clickId && clickId != "") {
                                    click = clickId;
                                } else {
                                   if(menuList[menuList.length - 1]){
                                       click = menuList[menuList.length - 1].menuId;
                                   }
                                }
                                $('.a-buttom-control[dataid="' + click + '"]').trigger('click');
                            } else {
                                var click = "none";
                                var secondMenu = findMenuById(parentId);
                                if (secondMenu.customMenusTList && secondMenu.customMenusTList.length > 0) {
                                    click = secondMenu.customMenusTList[0].menuId;
                                }
                                if (clickId && clickId != "") {
                                    click = clickId;
                                }
                                $('.li-secondary-menu[dataid="' + click + '"][dataparentid="' + parentId + '"]').trigger('click');
                            }
                        }

                        /******************************************form赋值方法***************************************/
                        //右侧form置空
                        function cleanFormValues(menuType) {
                            $('#menuLevel').val(null);
                            $('#menuName').val(null);
                            $('#content').val(null);
                            $('#menuId').val(null);
                            $('#clickType').val(null);
                        }

                        //赋值右侧form
                        function initFormValues(menu, menuType) {
                            $('#menuLevel').val(menuType);
                            if (menu) {
                                $('#menuName').val(menu.menuName);
                                if (!$('#menuName').next().hasClass('pright')) {
                                    $('#menuName').next().toggleClass('pright');
                                }
                                if (menu.clickType == menuTypeEum.VIEW) {//只在url类型下加载content值
                                    $($('label.cbr-inline')[2]).trigger('click');
                                    $('#content').val(menu.content);
                                    if (!$('#content').next().next().hasClass('pright')) {
                                        $('#content').next().next().toggleClass('pright');
                                    }
                                } else if (menu.clickType == menuTypeEum.MEDIA_ID) {
                                    material = DF.getComponent(comId);
                                    $($('label.cbr-inline')[1]).trigger('click');
                                    $('#content').val(menu.content);
                                    if (menu.content != "") {
                                        material.setValue(menu.content, "mpnews");
                                    } else {
                                        material.clear();
                                    }
                                } else {
                                    $('#content').val(null);
                                    $($('label.cbr-inline')[0]).trigger('click');
                                }
                                $('#menuId').val(menu.id);
                                $('#parentId').val(menu.parentId);
                                $('#appId').val(appId);
                                $('#clickType').val(menu.clickType);
                            } else {//若为空菜单 则置空
                                $('#parentId').val(null);
                                $('#menuName').val(null);
                                $('#content').val(null);
                                $('#menuId').val(null);
                                $('#clickType').val(null);
                                $('#appId').val(appId);
                                $('#menuName').next().removeClass('pright');
                                $('#content').next().next().removeClass('pright');
                                $('label.cbr-inline').first().trigger('click');
                                if (material) {
                                    material.clear();
                                }
                            }
                        }

                        //初始化二级菜单表单
                        function initSecondForm(menu, menuType, ifAdd) {
                            $('#menuLevel').val(menuType);
                            if (ifAdd) {//若为空菜单 则保留父Id其它置空
                                $('#parentId').val(menu.id);
                                $('#menuName').val(null);
                                $('#content').val(null);
                                $('#menuId').val(null);
                                $('#clickType').val(null);
                                $('#appId').val(appId);
                                material.clear();
                                $('#menuName').next().removeClass('pright');
                                $('#content').next().next().removeClass('pright');
                            } else {
                                $('#menuName').val(menu.menuName);
                                if (!$('#menuName').next().hasClass('pright')) {
                                    $('#menuName').next().toggleClass('pright');
                                }
                                if (menu.clickType == menuTypeEum.VIEW) {//只在url类型下加载content值
                                    $($('label.cbr-inline')[2]).trigger('click');
                                    $('#content').val(menu.content);
                                    if (!$('#content').next().next().hasClass('pright')) {
                                        $('#content').next().next().toggleClass('pright');
                                    }
                                } else if (menu.clickType == menuTypeEum.MEDIA_ID) {
                                    material = DF.getComponent(comId);
                                    $($('label.cbr-inline')[1]).trigger('click');
                                    // $('#content').val(menu.content);
                                    if (menu.content != "") {
                                        material.setValue(menu.content, "mpnews");
                                    } else {
                                        material.clear();
                                    }
                                } else {
                                    $('#content').val(null);
                                    $($('label.cbr-inline')[0]).trigger('click');
                                }
                                $('#menuId').val(menu.id);
                                $('#parentId').val(menu.parentId);
                                $('#appId').val(appId);
                                $('#clickType').val(menu.clickType);
                            }
                        }

                        //根据form数据及是否为空从form封装menu对象
                        function packagMenuByFormValue() {
                            var menu = findMenuById($('#menuId').val());
                            var flag = menu ? false : true;
                            if (flag) {
                                menu = {};
                                menu.parentId = -1;
                                menu.customMenusTList = null;
                            }
                            menu.clickType = $('#clickType').val();
                            switch (menu.clickType) {
                                case "media_id":
                                {
                                    if (material) {
                                        if (material.getValue() == "" || !material.getValue()) {
                                            alert("请选择素材后提交！");
                                            return false;
                                        }
                                        menu.content = material.getValue().media_id;
                                    }
                                    break;
                                }
                                case "click":
                                {
                                    menu.content = "";
                                    break;
                                }
                                case "view":
                                {
                                    menu.content = $('#content').val();
                                    break;
                                }
                            }
                            menu.menuName = $('#menuName').val();
                            menu.appId = appId;
                            return menu;
                        }

                        /******************************************页面保存，删除基本方法***************************************/
                        function saveBottomMenuForm() {
                            //首先判断保存类型 view为url view_limited为图文消息
                            if ($('#clickType').val() == menuTypeEum.VIEW || $('#clickType').val() == menuTypeEum.MEDIA_ID) {
                                return saveBottomMenuURLForm();
                            } else {
                                return saveBottomMenuChildForm();
                            }
                        }

                        //保存一级菜单添加二级菜单方法
                        function saveBottomMenuChildForm() {
                            var menu = findMenuById($('#menuId').val());
                            if (menu) {
                                var packageMenu = packagMenuByFormValue();
                                if (!packageMenu) {
                                    return false;
                                }
                                upDateMenuById($('#menuId').val(), packageMenu)
                                return true;
                            } else {
                                var packageMenu = packagMenuByFormValue();
                                if (!packageMenu) {
                                    return false;
                                }
                                addBottomObj(packageMenu)
                                return true;
                            }
                        }

                        //保存一级菜单URL方法
                        function saveBottomMenuURLForm() {
                            var menu = findMenuById($('#menuId').val());
                            if (menu) {
                                var packageMenu = packagMenuByFormValue();
                                if (!packageMenu) {
                                    return false;
                                }
                                upDateMenuById($('#menuId').val(), packageMenu)
                                return true;
                            } else {
                                var packageMenu = packagMenuByFormValue();
                                if (!packageMenu) {
                                    return false;
                                }
                                addBottomObj(packageMenu)
                                return true;
                            }
                        }

                        //保存二级菜单方法
                        function saveSecondaryForm() {
                            if ($('#menuId').val() && $('#menuId').val() != "") {
                                var menu = packagMenuByFormValue();
                                if (!menu) {
                                    return false
                                }
                                updateSecondaryObjByParent($('#parentId').val(), $('#menuId').val(), menu)
                                return true;
                            } else {
                                var menu = packagMenuByFormValue();
                                if (!menu) {
                                    return false;
                                }
                                addSecondaryObjByParent($('#parentId').val(), menu)
                                return true;
                            }
                        }

                        //删除方法
                        function deleteMenu() {
                            deleteForm(findMenuById($('#menuId').val()));
                        }

                        /******************************************ajax加载初始化数据，提交，保存，发布方法***************************************/
                        /*首先加载appId及secret*/
                        function loadAppDetail() {
                            var appType = DF.getUrlParam() ? DF.getUrlParam().type : "isNull";
                            DF.ajax({
                                type: 'get',
                                url: 'customMenusT/getApp/' + appType,
                                dataType: 'json',
                                success: function (data) {
                                    var data = data.result;
                                    appId = data.appId;
                                    appsecret = data.appsecret;
                                    firstInit();
                                },
                                error: function () {

                                }
                            })
                        }

                        //重新请求数据加载方法
                        function firstInit() {
                            DF.ajax({
                                type: 'get',
                                url: 'customMenusT/getMenus/' + appId,
                                dataType: 'json',
                                success: function (data) {
                                    menuList = data.result;
                                    initBottomMenu(menuList, true, false, menuTypeEum.ClICK);
                                    initSecondaryMenu(menuList, false, true);
                                    initFormCss("bottom");
                                }
                            })
                        }

                        //重新请求数据加载方法
                        function loadAndInit(menuId) {
                            DF.ajax({
                                type: 'get',
                                url: 'customMenusT/getMenus/' + appId,
                                dataType: 'json',
                                success: function (data) {
                                    menuList = data.result;
                                    if (menuId) {
                                        renderByType(true, null, menuId);
                                    } else {
                                        renderByType(true);
                                    }
                                }
                            })
                        }

                        //提交一级菜单
                        function subForm(ifBottom) {
                            if (checkoutData(saveType)) {
                                $('#save').showLoading();
                                DF.ajax({
                                    data: JSON.stringify({customMenusTList: menuList}),
                                    type: 'post',
                                    url: 'customMenusT/insertMenuList/' + appId,
                                    dataType: 'json',
                                    success: function (data) {
                                        menuList = data.result;
                                        renderByType(ifBottom, $('#parentId').val(), $('#menuId').val());
                                        DF.toast.success(data.message);
                                        $('#save').hideLoading();
                                    },
                                    error: function () {
                                        $('#save').hideLoading();
                                    }
                                })
                            }
                        }

                        //提交一级菜单并显示二级菜单方法
                        function subBottAndShowSecond() {
                            if (checkoutData(saveType)) {//校验数据
                                $('#save').showLoading();
                                DF.ajax({
                                    data: JSON.stringify({customMenusTList: menuList}),
                                    type: 'post',
                                    url: 'customMenusT/insertMenuList/' + appId,
                                    dataType: 'json',
                                    success: function (data) {
                                        var menuId = $('#menuId').val();
                                        menuList = data.result;
                                        if (menuId && menuId != "") {
                                            renderByType(false, menuId);
                                        } else {
                                            renderByType(false, menuList[menuList.length - 1].menuId);
                                        }
                                        DF.toast.success(data.message);
                                        $('#save').hideLoading();
                                    },
                                    error: function () {
                                        $('#save').hideLoading();
                                    }
                                })
                            }
                        }

                        //提交并发布
                        function subAndSendForm(ifBottom) {
                            if (checkoutData(sendType)) {
                                $('#saveAndSend').showLoading();
                                DF.ajax({
                                    data: JSON.stringify({customMenusTList: menuList}),
                                    type: 'post',
                                    url: 'customMenusT/saveAndSendMenuList/' + appId + '/' + appsecret,
                                    dataType: 'json',
                                    success: function (data) {
                                        $('#saveAndSend').hideLoading();
                                        if (data.result.chatMsg == "0") {
                                            DF.toast.success(data.message);
                                        } else {
                                            DF.toast.success("发布失败！");
                                        }
                                        menuList = data.result.data;
                                        renderByType(ifBottom, $('#parentId').val(), $('#menuId').val());
                                    },
                                    error: function () {
                                        $('#saveAndSend').hideLoading();
                                    }
                                })
                            }
                        }

                        //后台删除方法
                        function deleteForm(menu) {
                            if (!menu) {
                                alert("当前菜单无法删除！");
                                return;
                            }
                            var alertMsg = menu.customMenusTList ? '确认删除当前菜单及其二级菜单吗？' : '确认删除当前菜单吗？'
                            if (confirm(alertMsg)) {
                                $('#delete').showLoading();
                                DF.ajax({
                                    data: JSON.stringify({customMenusTList: [menu]}),
                                    type: 'delete',
                                    url: 'customMenusT/deletMenuList/' + appId,
                                    success: function (data) {
                                        menuList = data.result;
                                        if ($('#parentId').val() == "-1") {
                                            renderByType(true);
                                        } else {
                                            renderByType(false, $('#parentId').val());
                                        }
                                        DF.toast.success(data.message);
                                        $('#delete').hideLoading();
                                    },
                                    error: function () {
                                        $('#delete').hideLoading();
                                    }
                                })
                            }
                        }

                        //成功后回调函数 根据加载类型重新加载页面
                        function renderByType(ifBottom, parentId, clickId) {
                            if (ifBottom) {
                                initBottomMenu(menuList, true, false);
                                initSecondaryMenu(menuList, false, true);
                                if (findMenuById($('#menuId').val())) {
                                    initFormCss("bottom", findMenuById($('#menuId').val()).clickType);
                                } else {
                                    initFormCss("bottom", menuTypeEum.NONE);
                                }
                                clickByType(ifBottom, clickId);
                            } else {
                                initBottomMenu(menuList, false, true);
                                initSecondaryMenu(menuList, true, false);
                                if (findMenuById($('#menuId').val())) {
                                    initFormCss("second", findMenuById($('#menuId').val()).clickType);
                                } else {
                                    initFormCss("second", menuTypeEum.NONE);
                                }
                                fadeInSecondaryMenusByParentId(parentId);
                                clickByType(ifBottom, clickId, parentId);
                            }
                        }

                        /****************************************页面样式修改方法*************************************/
                        /*隐藏右侧菜单方法*/
                        function hideRightWin() {
                            $('#leftPanel').removeClass('col-md-5');
                            $('#rightPanel').toggleClass('hidden');
                        }

                        //根据菜单类型显示隐藏按钮
                        function ChangeFromByType(type) {
                            if (type == "url") {
                                //clickType置为1
                                $('#clickType').val("view");
                                //URL输入框丝显示
                                $('#content').show();
                                $('#alert').show();
                                //编辑二级菜单按钮隐藏
                                $('#editSecond').hide();
                                //显示span 并复制为url
                                $('#contentDiv').find('span').text('URL').show();
                                //显示素材库组件
                                $('#material').hide();
                            } else if (type == "msgRadio") {
                                //clickType置为1
                                $('#clickType').val(menuTypeEum.MEDIA_ID);
                                //URL输入框丝显示
                                $('#content').hide();
                                $('#alert').hide();
                                //编辑二级菜单按钮隐藏
                                $('#editSecond').hide();
                                //显示素材库组件
                                $('#material').show();
                                $('#contentDiv').find('span').hide();

                            } else {
                                //clickType置为2
                                $('#clickType').val("click");
                                //展示编辑二级菜单按钮
                                $('#editSecond').show();
                                //隐藏span
                                $('#contentDiv').find('span').hide();
                                //隐藏input url输入框
                                $('#content').hide();
                                $('#alert').hide();
                                //显示素材库组件
                                $('#material').hide();
                            }
                        }

                        //初始化form样式
                        function initFormCss(type, menuType) {
                            $('#changFormName').show();
                            $('#changFormName').text('菜单类型');
                            $('#menuRadio').show();
                            $('#radio').show()
                            $('#menuRadio').parent().show();
                            $('#return').show();
                            switch (type) {
                                case (menuEum.Bottom):
                                {/*一级菜单*/
                                    $('#return').hide();
                                    $('#menuName').attr('maxlength', '4');
                                    break;
                                }
                                case (menuEum.BOTTOMANDSECOND):
                                {/*一级菜单（选择二级菜单时展示）*/
                                    $('#menuRadio').parent().show();
                                    $('#return').hide();
                                    $('#menuName').attr('maxlength', '4');
                                    break;
                                }
                                case (menuEum.SECOND):
                                {/*二级菜单*/
                                    //编辑二级菜单按钮隐藏
                                    $('#editSecond').hide();
                                    $('#menuRadio').parent().hide();
                                    $('#return').show();
                                    $('#menuName').attr('maxlength', '8');
                                    break;
                                }

                            }
                            /*根据菜单反馈类型*/
                            switch (menuType) {
                                case (menuTypeEum.VIEW):
                                {
                                    //URL输入框丝显示
                                    $('#content').show();
                                    $('#alert').show();
                                    //显示span 并复制为url
                                    $('#contentDiv').find('span').text('请输入URL').show();
                                    $($('label.cbr-inline')[2]).trigger('click');
                                    break;
                                }
                                case (menuTypeEum.MEDIA_ID):
                                {
                                    $('#content').hide();
                                    $('#alert').hide();
                                    //显示span 并复制为url
                                    $('#contentDiv').find('span').hide();
                                    $($('label.cbr-inline')[1]).trigger('click');
                                    break;
                                }
                                case (menuTypeEum.ClICK):
                                {
                                    $($('label.cbr-inline')[0]).trigger('click');
                                    $('#radio').hide()
                                    $('#content').hide();
                                    $('#alert').hide();
                                    $('#changFormName').hide();
                                    //显示span 并复制为url
                                    $('#contentDiv').find('span').hide();
                                    break;
                                }
                                case(menuTypeEum.NONE):
                                {
                                    $($('label.cbr-inline')[1]).trigger('click');
                                    break;
                                }
                            }
                            formObj = DF.on('formChange', $('#form'));
                        }

                        /*************************************操作数据方法计划***********************************/
                        /*根据规则校验menuList*/
                        function checkoutData(type) {
                            if (type == "saveAndSend") {//发布校验
                                for (var i in menuList) {
                                    if (menuList[i].clickType == menuTypeEum.ClICK &&
                                            (menuList[i].customMenusTList == null || menuList[i].customMenusTList.length == 0)) {
                                        alert("请为" + menuList[i].menuName + "菜单添加二级菜单，否则无法发布！");
                                        return false;
                                    }
                                    if (menuList[i].clickType == menuTypeEum.MEDIA_ID) {//校验一级菜单 发送图文消息类型
                                        if (menuList[i].content == "" || menuList[i].content == null) {
                                            alert("请为" + menuList[i].menuName + "菜单添加图文素材，否则无法发布！");
                                            return false;
                                        }
                                    }
                                    if ((menuList[i].customMenusTList != null && menuList[i].customMenusTList.length !=
                                            0)) {
                                        if (menuList[i].customMenusTList.clickType == menuTypeEum.MEDIA_ID) {//校验一级菜单 发送图文消息类型
                                            if (menuList[i].customMenusTList.content == "" || menuList[i].customMenusTList.content == null) {
                                                alert("请为" + menuList[i].customMenusTList.menuName + "菜单添加图文素材，否则无法发布！");
                                                return false;
                                            }
                                        }
                                    }
                                }
                                return true;
                            }
                            if (type == "save") {
                                return true;
                            }
                        }

                        //根据一级节点Id添加二级节点数据对象
                        function addSecondaryObjByParent(menuId, childMenu) {
                            for (var i in menuList) {
                                if (menuList[i].id == menuId) {
                                    menuList[i].customMenusTList = [childMenu].concat(menuList[i].customMenusTList);
                                    break;
                                }
                            }
                        }

                        //根据一级节点Id修改二级节点数据对象
                        function updateSecondaryObjByParent(parentId, menuId, childMenu) {
                            for (var i in menuList) {
                                if (menuList[i].id == parentId) {
                                    for (var k in menuList[i].customMenusTList) {
                                        if (menuList[i].customMenusTList[k].menuId == menuId) {
                                            menuList[i].customMenusTList[k] = childMenu;
                                            break;
                                        }
                                    }
                                }
                            }
                        }

                        //根据一级对象及form构造二级对象
                        function madeSecondaryObj() {
                            var menu = {}
                            menu.clickType = "view";
                            menu.parentId = $('#menuId').val();
                            menu.menuName = $('#content').val();
                            menu.appId = appId;
                            return menu;
                        }

                        //添加一级节点数据对象
                        function addBottomObj(menu) {
                            if (menuList.length > 2) {
                                alert("最多添加三个一级菜单！");
                                return;
                            } else if (menuList.customMenusTList && menuList.customMenusTList.length > 5) {
                                alert("每个一级菜单最多添加5个二级菜单！");
                                return;
                            } else {
                                menuList[menuList.length] = menu;
                            }
                        }

                        //根据id修改数据对象
                        function upDateMenuById(id, menu) {
                            for (var i in menuList) {
                                if (menuList[i].id == id) {
                                    menuList[i] = menu;
                                    break;
                                }
                                if (menuList[i].customMenusTList) {
                                    for (var k in menuList[i].customMenusTList) {
                                        if (menuList[i].customMenusTList[k].menuId == id) {
                                            menuList[i].customMenusTList[k] = menu;
                                            break;
                                        }
                                    }
                                }
                            }
                        }

                        //根据id查找数据池中的数据对象
                        function findMenuById(id) {
                            for (var i in menuList) {
                                if (menuList[i].id == id) {
                                    return menuList[i];
                                }
                                if (menuList[i].customMenusTList) {
                                    for (var k in menuList[i].customMenusTList) {
                                        if (menuList[i].customMenusTList[k].menuId == id) {
                                            return menuList[i].customMenusTList[k];
                                        }
                                    }
                                }
                            }
                        }

                        //根据id删除数据池中的数据对象
                        function deleteMenuById(id) {
                            for (var i in menuList) {
                                if (menuList[i].id == id) {
                                    menuList.splice(i, 1);
                                    break
                                }
                                if (menuList[i].customMenusTList) {
                                    for (var k in menuList[i].customMenusTList) {
                                        if (menuList[i].customMenusTList[k].menuId == id) {
                                            menuList[i].customMenusTList.splice(i, 1);
                                            break;
                                        }
                                    }
                                }
                            }
                        }
                    })
                    (jQuery);
                </script>
                <!-- 左边PANEL END -->

            </div>
        </div>
    </div>
</div>


